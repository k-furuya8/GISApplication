{"ast":null,"code":"import http from 'http';\nimport https from 'https';\nimport urlMod from 'url';\nimport { BaseClient, BaseResponse } from './base.js';\nimport { AbortError } from '../../utils.js';\n\nclass HttpResponse extends BaseResponse {\n  /**\n   * BaseResponse facade for node HTTP/HTTPS API Response\n   * @param {http.ServerResponse} response\n   */\n  constructor(response, dataPromise) {\n    super();\n    this.response = response;\n    this.dataPromise = dataPromise;\n  }\n\n  get status() {\n    return this.response.statusCode;\n  }\n\n  getHeader(name) {\n    return this.response.headers[name];\n  }\n\n  async getData() {\n    const data = await this.dataPromise;\n    return data;\n  }\n\n}\n\nexport class HttpClient extends BaseClient {\n  constructor(url) {\n    super(url);\n    this.parsedUrl = urlMod.parse(this.url);\n    this.httpApi = this.parsedUrl.protocol === 'http:' ? http : https;\n  }\n\n  constructRequest(headers, signal) {\n    return new Promise((resolve, reject) => {\n      const request = this.httpApi.get({ ...this.parsedUrl,\n        headers\n      }, response => {\n        const dataPromise = new Promise(resolveData => {\n          const chunks = []; // collect chunks\n\n          response.on('data', chunk => {\n            chunks.push(chunk);\n          }); // concatenate all chunks and resolve the promise with the resulting buffer\n\n          response.on('end', () => {\n            const data = Buffer.concat(chunks).buffer;\n            resolveData(data);\n          });\n          response.on('error', reject);\n        });\n        resolve(new HttpResponse(response, dataPromise));\n      });\n      request.on('error', reject);\n\n      if (signal) {\n        if (signal.aborted) {\n          request.destroy(new AbortError('Request aborted'));\n        }\n\n        signal.addEventListener('abort', () => request.destroy(new AbortError('Request aborted')));\n      }\n    });\n  }\n\n  async request() {\n    let {\n      headers,\n      signal\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const response = await this.constructRequest(headers, signal);\n    return response;\n  }\n\n}","map":{"version":3,"names":["http","https","urlMod","BaseClient","BaseResponse","AbortError","HttpResponse","constructor","response","dataPromise","status","statusCode","getHeader","name","headers","getData","data","HttpClient","url","parsedUrl","parse","httpApi","protocol","constructRequest","signal","Promise","resolve","reject","request","get","resolveData","chunks","on","chunk","push","Buffer","concat","buffer","aborted","destroy","addEventListener"],"sources":["C:/Users/81806/Documents/work/GIS_APP/gis_app1/node_modules/geotiff/dist-module/source/client/http.js"],"sourcesContent":["import http from 'http';\nimport https from 'https';\nimport urlMod from 'url';\n\nimport { BaseClient, BaseResponse } from './base.js';\nimport { AbortError } from '../../utils.js';\n\nclass HttpResponse extends BaseResponse {\n  /**\n   * BaseResponse facade for node HTTP/HTTPS API Response\n   * @param {http.ServerResponse} response\n   */\n  constructor(response, dataPromise) {\n    super();\n    this.response = response;\n    this.dataPromise = dataPromise;\n  }\n\n  get status() {\n    return this.response.statusCode;\n  }\n\n  getHeader(name) {\n    return this.response.headers[name];\n  }\n\n  async getData() {\n    const data = await this.dataPromise;\n    return data;\n  }\n}\n\nexport class HttpClient extends BaseClient {\n  constructor(url) {\n    super(url);\n    this.parsedUrl = urlMod.parse(this.url);\n    this.httpApi = (this.parsedUrl.protocol === 'http:' ? http : https);\n  }\n\n  constructRequest(headers, signal) {\n    return new Promise((resolve, reject) => {\n      const request = this.httpApi.get(\n        {\n          ...this.parsedUrl,\n          headers,\n        },\n        (response) => {\n          const dataPromise = new Promise((resolveData) => {\n            const chunks = [];\n\n            // collect chunks\n            response.on('data', (chunk) => {\n              chunks.push(chunk);\n            });\n\n            // concatenate all chunks and resolve the promise with the resulting buffer\n            response.on('end', () => {\n              const data = Buffer.concat(chunks).buffer;\n              resolveData(data);\n            });\n            response.on('error', reject);\n          });\n          resolve(new HttpResponse(response, dataPromise));\n        },\n      );\n      request.on('error', reject);\n\n      if (signal) {\n        if (signal.aborted) {\n          request.destroy(new AbortError('Request aborted'));\n        }\n        signal.addEventListener('abort', () => request.destroy(new AbortError('Request aborted')));\n      }\n    });\n  }\n\n  async request({ headers, signal } = {}) {\n    const response = await this.constructRequest(headers, signal);\n    return response;\n  }\n}\n"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,MAAjB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP,MAAmB,KAAnB;AAEA,SAASC,UAAT,EAAqBC,YAArB,QAAyC,WAAzC;AACA,SAASC,UAAT,QAA2B,gBAA3B;;AAEA,MAAMC,YAAN,SAA2BF,YAA3B,CAAwC;EACtC;AACF;AACA;AACA;EACEG,WAAW,CAACC,QAAD,EAAWC,WAAX,EAAwB;IACjC;IACA,KAAKD,QAAL,GAAgBA,QAAhB;IACA,KAAKC,WAAL,GAAmBA,WAAnB;EACD;;EAES,IAANC,MAAM,GAAG;IACX,OAAO,KAAKF,QAAL,CAAcG,UAArB;EACD;;EAEDC,SAAS,CAACC,IAAD,EAAO;IACd,OAAO,KAAKL,QAAL,CAAcM,OAAd,CAAsBD,IAAtB,CAAP;EACD;;EAEY,MAAPE,OAAO,GAAG;IACd,MAAMC,IAAI,GAAG,MAAM,KAAKP,WAAxB;IACA,OAAOO,IAAP;EACD;;AAtBqC;;AAyBxC,OAAO,MAAMC,UAAN,SAAyBd,UAAzB,CAAoC;EACzCI,WAAW,CAACW,GAAD,EAAM;IACf,MAAMA,GAAN;IACA,KAAKC,SAAL,GAAiBjB,MAAM,CAACkB,KAAP,CAAa,KAAKF,GAAlB,CAAjB;IACA,KAAKG,OAAL,GAAgB,KAAKF,SAAL,CAAeG,QAAf,KAA4B,OAA5B,GAAsCtB,IAAtC,GAA6CC,KAA7D;EACD;;EAEDsB,gBAAgB,CAACT,OAAD,EAAUU,MAAV,EAAkB;IAChC,OAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;MACtC,MAAMC,OAAO,GAAG,KAAKP,OAAL,CAAaQ,GAAb,CACd,EACE,GAAG,KAAKV,SADV;QAEEL;MAFF,CADc,EAKbN,QAAD,IAAc;QACZ,MAAMC,WAAW,GAAG,IAAIgB,OAAJ,CAAaK,WAAD,IAAiB;UAC/C,MAAMC,MAAM,GAAG,EAAf,CAD+C,CAG/C;;UACAvB,QAAQ,CAACwB,EAAT,CAAY,MAAZ,EAAqBC,KAAD,IAAW;YAC7BF,MAAM,CAACG,IAAP,CAAYD,KAAZ;UACD,CAFD,EAJ+C,CAQ/C;;UACAzB,QAAQ,CAACwB,EAAT,CAAY,KAAZ,EAAmB,MAAM;YACvB,MAAMhB,IAAI,GAAGmB,MAAM,CAACC,MAAP,CAAcL,MAAd,EAAsBM,MAAnC;YACAP,WAAW,CAACd,IAAD,CAAX;UACD,CAHD;UAIAR,QAAQ,CAACwB,EAAT,CAAY,OAAZ,EAAqBL,MAArB;QACD,CAdmB,CAApB;QAeAD,OAAO,CAAC,IAAIpB,YAAJ,CAAiBE,QAAjB,EAA2BC,WAA3B,CAAD,CAAP;MACD,CAtBa,CAAhB;MAwBAmB,OAAO,CAACI,EAAR,CAAW,OAAX,EAAoBL,MAApB;;MAEA,IAAIH,MAAJ,EAAY;QACV,IAAIA,MAAM,CAACc,OAAX,EAAoB;UAClBV,OAAO,CAACW,OAAR,CAAgB,IAAIlC,UAAJ,CAAe,iBAAf,CAAhB;QACD;;QACDmB,MAAM,CAACgB,gBAAP,CAAwB,OAAxB,EAAiC,MAAMZ,OAAO,CAACW,OAAR,CAAgB,IAAIlC,UAAJ,CAAe,iBAAf,CAAhB,CAAvC;MACD;IACF,CAjCM,CAAP;EAkCD;;EAEY,MAAPuB,OAAO,GAA2B;IAAA,IAA1B;MAAEd,OAAF;MAAWU;IAAX,CAA0B,uEAAJ,EAAI;IACtC,MAAMhB,QAAQ,GAAG,MAAM,KAAKe,gBAAL,CAAsBT,OAAtB,EAA+BU,MAA/B,CAAvB;IACA,OAAOhB,QAAP;EACD;;AA/CwC"},"metadata":{},"sourceType":"module"}