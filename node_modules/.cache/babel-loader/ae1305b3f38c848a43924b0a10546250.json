{"ast":null,"code":"import fs from 'fs';\nimport { BaseSource } from './basesource.js';\n\nfunction closeAsync(fd) {\n  return new Promise((resolve, reject) => {\n    fs.close(fd, err => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nfunction openAsync(path, flags) {\n  let mode = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;\n  return new Promise((resolve, reject) => {\n    fs.open(path, flags, mode, (err, fd) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(fd);\n      }\n    });\n  });\n}\n\nfunction readAsync() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return new Promise((resolve, reject) => {\n    fs.read(...args, (err, bytesRead, buffer) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve({\n          bytesRead,\n          buffer\n        });\n      }\n    });\n  });\n}\n\nclass FileSource extends BaseSource {\n  constructor(path) {\n    super();\n    this.path = path;\n    this.openRequest = openAsync(path, 'r');\n  }\n\n  async fetchSlice(slice) {\n    // TODO: use `signal`\n    const fd = await this.openRequest;\n    const {\n      buffer\n    } = await readAsync(fd, Buffer.alloc(slice.length), 0, slice.length, slice.offset);\n    return buffer.buffer;\n  }\n\n  async close() {\n    const fd = await this.openRequest;\n    await closeAsync(fd);\n  }\n\n}\n\nexport function makeFileSource(path) {\n  return new FileSource(path);\n}","map":{"version":3,"names":["fs","BaseSource","closeAsync","fd","Promise","resolve","reject","close","err","openAsync","path","flags","mode","undefined","open","readAsync","args","read","bytesRead","buffer","FileSource","constructor","openRequest","fetchSlice","slice","Buffer","alloc","length","offset","makeFileSource"],"sources":["C:/Users/81806/Documents/work/GIS_APP/gis_app1/node_modules/geotiff/dist-module/source/file.js"],"sourcesContent":["import fs from 'fs';\nimport { BaseSource } from './basesource.js';\n\nfunction closeAsync(fd) {\n  return new Promise((resolve, reject) => {\n    fs.close(fd, (err) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nfunction openAsync(path, flags, mode = undefined) {\n  return new Promise((resolve, reject) => {\n    fs.open(path, flags, mode, (err, fd) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(fd);\n      }\n    });\n  });\n}\n\nfunction readAsync(...args) {\n  return new Promise((resolve, reject) => {\n    fs.read(...args, (err, bytesRead, buffer) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve({ bytesRead, buffer });\n      }\n    });\n  });\n}\n\nclass FileSource extends BaseSource {\n  constructor(path) {\n    super();\n    this.path = path;\n    this.openRequest = openAsync(path, 'r');\n  }\n\n  async fetchSlice(slice) {\n    // TODO: use `signal`\n    const fd = await this.openRequest;\n    const { buffer } = await readAsync(\n      fd,\n      Buffer.alloc(slice.length),\n      0,\n      slice.length,\n      slice.offset,\n    );\n    return buffer.buffer;\n  }\n\n  async close() {\n    const fd = await this.openRequest;\n    await closeAsync(fd);\n  }\n}\n\nexport function makeFileSource(path) {\n  return new FileSource(path);\n}\n"],"mappings":"AAAA,OAAOA,EAAP,MAAe,IAAf;AACA,SAASC,UAAT,QAA2B,iBAA3B;;AAEA,SAASC,UAAT,CAAoBC,EAApB,EAAwB;EACtB,OAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;IACtCN,EAAE,CAACO,KAAH,CAASJ,EAAT,EAAcK,GAAD,IAAS;MACpB,IAAIA,GAAJ,EAAS;QACPF,MAAM,CAACE,GAAD,CAAN;MACD,CAFD,MAEO;QACLH,OAAO;MACR;IACF,CAND;EAOD,CARM,CAAP;AASD;;AAED,SAASI,SAAT,CAAmBC,IAAnB,EAAyBC,KAAzB,EAAkD;EAAA,IAAlBC,IAAkB,uEAAXC,SAAW;EAChD,OAAO,IAAIT,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;IACtCN,EAAE,CAACc,IAAH,CAAQJ,IAAR,EAAcC,KAAd,EAAqBC,IAArB,EAA2B,CAACJ,GAAD,EAAML,EAAN,KAAa;MACtC,IAAIK,GAAJ,EAAS;QACPF,MAAM,CAACE,GAAD,CAAN;MACD,CAFD,MAEO;QACLH,OAAO,CAACF,EAAD,CAAP;MACD;IACF,CAND;EAOD,CARM,CAAP;AASD;;AAED,SAASY,SAAT,GAA4B;EAAA,kCAANC,IAAM;IAANA,IAAM;EAAA;;EAC1B,OAAO,IAAIZ,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;IACtCN,EAAE,CAACiB,IAAH,CAAQ,GAAGD,IAAX,EAAiB,CAACR,GAAD,EAAMU,SAAN,EAAiBC,MAAjB,KAA4B;MAC3C,IAAIX,GAAJ,EAAS;QACPF,MAAM,CAACE,GAAD,CAAN;MACD,CAFD,MAEO;QACLH,OAAO,CAAC;UAAEa,SAAF;UAAaC;QAAb,CAAD,CAAP;MACD;IACF,CAND;EAOD,CARM,CAAP;AASD;;AAED,MAAMC,UAAN,SAAyBnB,UAAzB,CAAoC;EAClCoB,WAAW,CAACX,IAAD,EAAO;IAChB;IACA,KAAKA,IAAL,GAAYA,IAAZ;IACA,KAAKY,WAAL,GAAmBb,SAAS,CAACC,IAAD,EAAO,GAAP,CAA5B;EACD;;EAEe,MAAVa,UAAU,CAACC,KAAD,EAAQ;IACtB;IACA,MAAMrB,EAAE,GAAG,MAAM,KAAKmB,WAAtB;IACA,MAAM;MAAEH;IAAF,IAAa,MAAMJ,SAAS,CAChCZ,EADgC,EAEhCsB,MAAM,CAACC,KAAP,CAAaF,KAAK,CAACG,MAAnB,CAFgC,EAGhC,CAHgC,EAIhCH,KAAK,CAACG,MAJ0B,EAKhCH,KAAK,CAACI,MAL0B,CAAlC;IAOA,OAAOT,MAAM,CAACA,MAAd;EACD;;EAEU,MAALZ,KAAK,GAAG;IACZ,MAAMJ,EAAE,GAAG,MAAM,KAAKmB,WAAtB;IACA,MAAMpB,UAAU,CAACC,EAAD,CAAhB;EACD;;AAvBiC;;AA0BpC,OAAO,SAAS0B,cAAT,CAAwBnB,IAAxB,EAA8B;EACnC,OAAO,IAAIU,UAAJ,CAAeV,IAAf,CAAP;AACD"},"metadata":{},"sourceType":"module"}